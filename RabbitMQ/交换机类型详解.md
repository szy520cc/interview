### RabbitMQ 交换机类型详解

RabbitMQ 的 **Exchange（交换机）** 是消息路由的核心组件，其分发策略因类型而异。当前主流的交换机类型包括 **Direct**、**Fanout**、**Topic** 和 **Headers** 四种：

---

#### **1. Direct Exchange（直连交换机）**
- **定义**：  
  根据消息的 **路由键（Routing Key）** 与队列绑定的 **绑定键（Binding Key）** **完全匹配**，将消息路由到指定队列。
  
- **工作原理**：  
  1. 队列绑定到交换机时需指定绑定键（Binding Key）。  
  2. 消息发送时需携带路由键（Routing Key）。  
  3. 只有当 Routing Key 与 Binding Key **完全一致**时，消息才会被路由到该队列。

- **使用场景**：  
  - 精确匹配需求（如订单分类、日志分级）。  
  - 示例：  
    - 队列 `error_logs` 绑定键为 `error`，队列 `info_logs` 绑定键为 `info`。  
    - 发送消息时，若路由键为 `error`，仅 `error_logs` 收到消息。

- **特点**：  
  - **严格匹配**：区分大小写（`Error` ≠ `error`）。  
  - **单播模式**：消息仅发送到匹配的队列。  

---

#### **2. Fanout Exchange（扇型交换机）**
- **定义**：  
  忽略路由键，将消息 **广播到所有绑定队列**。

- **工作原理**：  
  1. 队列绑定到交换机时无需指定绑定键。  
  2. 消息发送时无需指定路由键。  
  3. 所有绑定队列 **无条件** 接收到消息。

- **使用场景**：  
  - 广播通知（如系统配置更新、全局事件）。  
  - 示例：  
    - 队列 `queue1` 和 `queue2` 都绑定到 `fanout_exchange`。  
    - 发送消息后，`queue1` 和 `queue2` 都会收到副本。

- **特点**：  
  - **广播模式**：消息复制到所有绑定队列。  
  - **高性能**：分发速度最快。  

---

#### **3. Topic Exchange（主题交换机）**
- **定义**：  
  通过 **模式匹配**（支持通配符 `*` 和 `#`）将消息路由到队列。

- **工作原理**：  
  1. 路由键和绑定键按 `.` 分隔为单词（如 `a.b.c` → `a`, `b`, `c`）。  
  2. 通配符规则：  
     - `*`：匹配 **一个单词**（如 `a.*.c` 匹配 `a.b.c`）。  
     - `#`：匹配 **零个或多个单词**（如 `#.b.#` 匹配 `a.b.c` 或 `.b`）。  
  3. 消息路由到匹配绑定键的队列。

- **使用场景**：  
  - 多条件路由（如日志按来源和严重性分类）。  
  - 示例：  
    - 队列 `Q1` 绑定键为 `*.TT.*`，队列 `Q2` 绑定键为 `TT.#`。  
    - 消息路由键为 `A.TT.B` → `Q1` 收到；路由键为 `TT.AA.BB` → `Q2` 收到。

- **特点**：  
  - **灵活匹配**：结合 `*` 和 `#` 实现复杂路由。  
  - **兼容性**：  
    - 当绑定键无通配符时，行为等同于 **Direct Exchange**。  
    - 当绑定键为 `#` 时，行为等同于 **Fanout Exchange**。  

---

#### **4. Headers Exchange（头交换机）**
- **定义**：  
  根据消息的 **Header 属性** 进行匹配，而非路由键。

- **工作原理**：  
  1. 队列绑定到交换机时需指定 Header 的键值对。  
  2. 消息发送时需携带 Header 属性。  
  3. 匹配规则：  
     - `x-match: all`：Header 必须完全匹配。  
     - `x-match: any`：Header 只需部分匹配。  

- **使用场景**：  
  - 复杂条件过滤（如根据业务属性路由）。  
  - 示例：  
    - 队列绑定 Header `{color: red, size: big}`，`x-match: all`。  
    - 消息 Header 包含 `color: red` 和 `size: big` 时才会被路由。

- **特点**：  
  - **性能较低**：匹配逻辑复杂，实际应用较少。  
  - **已弃用**：现代场景中几乎不再使用。  

---

### **交换机类型对比表**

| 交换机类型       | 路由键匹配规则         | 广播能力 | 灵活性 | 典型场景                |
|------------------|------------------------|----------|--------|-------------------------|
| **Direct**       | 完全匹配               | ❌       | 低     | 精确路由（订单、日志）  |
| **Fanout**       | 无匹配（忽略路由键）   | ✅       | 最高   | 广播通知                |
| **Topic**        | 模式匹配（`*`/`#`）    | ❌       | 高     | 多条件路由（日志分类）  |
| **Headers**      | Header 属性匹配        | ❌       | 中     | 复杂条件过滤（已弃用）  |

---

### **核心区别总结**
1. **Direct vs. Topic**：  
   - Direct 严格匹配，Topic 支持通配符。  
   - Topic 可兼容 Direct 和 Fanout 行为。  

2. **Fanout vs. Topic**：  
   - Fanout 是 Topic 的极端简化版（绑定键为 `#`）。  
   - Fanout 性能更高，但灵活性差。  

3. **Headers**：  
   - 唯一依赖 Header 的交换机，性能差且已过时。  

---

### **示例图解**
```plaintext
生产者 → [Direct Exchange] → 队列（完全匹配）  
生产者 → [Fanout Exchange] → 所有绑定队列（广播）  
生产者 → [Topic Exchange] → 队列（模式匹配 */#）  
生产者 → [Headers Exchange] → 队列（Header 属性匹配）
```

通过以上分类和对比，可清晰掌握 RabbitMQ 交换机的核心原理和适用场景。